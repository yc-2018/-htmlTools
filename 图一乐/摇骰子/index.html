<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>大话骰</title>
  <link rel="stylesheet" href="index.css">

</head>
<body>

<div class="dice-main">
  <div class="dice-cover" id="diceCover" style="transform:translateY(-80%)"></div>

  <div class="dices" id="dices"></div>

  <div class="dice-base"></div>

</div>

<div style="display: grid;grid-template-columns: repeat(3, 1fr); gap: 10px;">
  <button class="shakeDice-button" id="openCoverB" onclick="handleCover()">关</button>
  <button class="shakeDice-button" onclick="shakeDice()">计算</button>
  <button class="shakeDice-button" id="shakeDiceB" onclick="shakeDice()">摇🎲</button>
</div>


</body>

<script>
  // 提前加载音效
  const openMp3 = new Audio('./open.mp3');
  const diceMp3 = new Audio('./dice.mp3');
  let isCoverOpen = true; // 骰盅开关状态

  const diceCover = document.getElementById('diceCover')      // 骰盅
  const dices = document.getElementById('dices')              // 骰子容器
  const openCoverB = document.getElementById('openCoverB')    // 骰盅开关按钮
  const shakeDiceB = document.getElementById('shakeDiceB')    // 摇骰子按钮

  shakeDice(true) // 初始化骰子

  /**
   * 摇骰子逻辑
   *
   * @author 𝓒𝓱𝓮𝓷𝓖𝓾𝓪𝓷𝓰𝓛𝓸𝓷𝓰
   * @since 2025/9/15 2:42
   */
  function shakeDice(isInit = false) {
    let diceNumbers = Array(5).fill(0)
    if (!isInit) {
      shakeDiceB.disabled = true
      isCoverOpen = true
      handleCover()
      diceMp3.play()
      diceNumbers = diceNumbers.map(() => Math.floor(Math.random() * 6) + 1).sort()
    }

    window.setTimeout(() => {
      dices.innerHTML = '';
      diceNumbers.forEach(diceNumber => {
        const dice = document.createElement('img')
        dice.src = `./dice-svg/${diceNumber}.svg`
        dices.appendChild(dice)
        shakeDiceB.disabled = false
      })
    }, 200)

  }

  /**
   * 处理骰盅开关
   *
   * @param {boolean} isCalculate 是否计算
   * @author 𝓒𝓱𝓮𝓷𝓖𝓾𝓪𝓷𝓰𝓛𝓸𝓷𝓰
   * @since 2025/9/15 2:58
   */
  function handleCover(isCalculate = false) {
    if (isCoverOpen) {
      openCoverB.innerText = '开'
      diceCover.style.transform = 'translateY(0)'
    } else {
      diceCover.style.transform = 'translateY(-80%)'
      openCoverB.innerText = '关'
    }
    isCoverOpen = !isCoverOpen
  }


</script>
</html>