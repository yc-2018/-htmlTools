<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>å¤§è¯éª°</title>
  <link rel="stylesheet" href="index.css">

</head>
<body>

<div class="dice-main" id="diceMain">
  <div class="dice-cover" id="diceCover" style="transform:translateY(-80%)" onclick="handleCover()"></div>

  <div class="dices" id="dices"></div>

  <div class="dice-base" id="diceBase"></div>

</div>

<div style="display: grid;grid-template-columns: repeat(3, 1fr); gap: 10px;margin-bottom: 20px;">
  <button class="shakeDice-button" id="openCoverB" onclick="handleCover()">å…³</button>
  <button class="shakeDice-button" onclick="calculate()">å¼€!(ç®—)</button>
  <button class="shakeDice-button" id="shakeDiceB" onclick="shakeDice()">æ‘‡ğŸ²</button>
</div>

<div id="result"></div>
<div id="resultSpecial"></div>

<!-- ä¸€äº›æ— è¶³è½»é‡çš„æŒ‰é’® -->
<div style="margin-top: 10px">
  <div>
    <label for="openMp3Check">å¼€ç›…æ¨æˆ¬éŸ³æ•ˆ</label>
    <input type="checkbox" id="openMp3Check" checked/>
  </div>

  <div>
    <label for="semiTransparent">éª°ç›…åŠé€æ˜</label>
    <input type="checkbox" id="semiTransparent" onclick="handleTransparency(this)"/>
  </div>

  <div>
    <label for="noAutoCover">æ‘‡éª°å­ä¸è‡ªåŠ¨ç›–ç›…</label>
    <input type="checkbox" id="noAutoCover"/>
  </div>
</div>


</body>

<script>
  // æå‰åŠ è½½éŸ³æ•ˆ
  const openMp3 = new Audio('./open.mp3');
  const diceMp3 = new Audio('./dice.mp3');
  let isCoverOpen = true; // éª°ç›…å¼€å…³çŠ¶æ€

  const diceMain = document.getElementById('diceMain')            // éª°å­å…¨éƒ¨
  const diceCover = document.getElementById('diceCover')          // éª°ç›…
  const dices = document.getElementById('dices')                  // éª°å­å®¹å™¨
  const diceBase = document.getElementById('diceBase')            // å®¹å™¨åº•åº§
  const openCoverB = document.getElementById('openCoverB')        // éª°ç›…å¼€å…³æŒ‰é’®
  const shakeDiceB = document.getElementById('shakeDiceB')        // æ‘‡éª°å­æŒ‰é’®
  const result = document.getElementById('result')                // å¼€çš„ç»“æœ
  const resultSpecial = document.getElementById('resultSpecial')  // å¼€çš„ç»“æœ(ç‰¹æ®Š
  const playOpenMp3 = document.getElementById('openMp3Check');    // å‹¾é€‰ æ˜¯å¦æ’­æ”¾å¼€éª°ç›…éŸ³æ•ˆ(æ¨æˆ¬å¤§å«:å¼€!!!
  const noAutoCover = document.getElementById('noAutoCover');     // å‹¾é€‰ æ˜¯å¦è‡ªåŠ¨ç›–ç›–å­

  shakeDice(true) // åˆå§‹åŒ–éª°å­

  /**
   * æ‘‡éª°å­é€»è¾‘
   *
   * @author ğ“’ğ“±ğ“®ğ“·ğ“–ğ“¾ğ“ªğ“·ğ“°ğ“›ğ“¸ğ“·ğ“°
   * @since 2025/9/15 2:42
   */
  function shakeDice(isInit = false) {
    let diceNumbers = Array(5).fill(1)
    if (!isInit) {
      shakeDiceB.disabled = true          // ç¦ç”¨æŒ‰é’®
      if (!noAutoCover.checked) handleCover(isCoverOpen = true)     // å…³é—­éª°ç›…
      diceMain.classList.add('shaking');  // æ·»åŠ æ‘‡åŠ¨åŠ¨ç”»
      diceMp3.play()                      // æ’­æ”¾éª°å­éŸ³æ•ˆ
      diceNumbers = diceNumbers.map(() => Math.floor(Math.random() * 6) + 1).sort()
      result.innerHTML = '';
      resultSpecial.innerHTML = '';
    }

    window.setTimeout(() => {
      dices.innerHTML = '';
      diceNumbers.forEach(diceNumber => {
        const dice = document.createElement('img')
        dice.src = `./dice-svg/${diceNumber}.svg`
        dices.appendChild(dice)
        shakeDiceB.disabled = false
      })
    }, 200)

    // 2ç§’ååœæ­¢æ‘‡åŠ¨
    setTimeout(() => {
      diceMain.classList.remove('shaking');
    }, 1000);

  }

  /**
   * å¤„ç†éª°ç›…å¼€å…³
   *
   * @author ğ“’ğ“±ğ“®ğ“·ğ“–ğ“¾ğ“ªğ“·ğ“°ğ“›ğ“¸ğ“·ğ“°
   * @since 2025/9/15 2:58
   */
  function handleCover() {
    if (isCoverOpen) {
      openCoverB.innerText = 'å¼€'
      diceCover.style.transform = 'translateY(0)'
    } else {
      diceCover.style.transform = 'translateY(-80%)'
      openCoverB.innerText = 'å…³'
    }
    isCoverOpen = !isCoverOpen
  }

  /**
   * è®¡ç®—é€»è¾‘
   *
   * @author ğ“’ğ“±ğ“®ğ“·ğ“–ğ“¾ğ“ªğ“·ğ“°ğ“›ğ“¸ğ“·ğ“°
   * @since 2025/9/15 2:58
   */
  function calculate() {
    if (playOpenMp3.checked) openMp3.play()
    handleCover(isCoverOpen = false)
    const resultCountMap = {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0}

    // æ‹¿åˆ°å…¨éƒ¨æ•°å­—(ä»urlé‡Œé¢åˆ‡å‰²å‡ºæ¥
    dices.querySelectorAll('img').forEach(dice => {
      const diceNumber = Number(dice.src.match(/\/dice-svg\/(\d+)\.svg/)[1])
      resultCountMap[diceNumber]++
    })

    delete resultCountMap[0]; // åˆ é™¤ 0 çš„ksy

    // æ£€æŸ¥æ˜¯å¦æ˜¯çº¯è±¹
    const entries = Object.entries(resultCountMap);
    const findPureLeopard = entries.find(([_key, value]) => value === 5);
    if (findPureLeopard) {
      return resultSpecial.innerHTML = `ğŸ†çº¯è±¹<img src="./dice-svg/${findPureLeopard[0]}.svg"/>5+2ä¸ª`
    }
    // æ£€æŸ¥æ˜¯å¦æ˜¯è±¹å­
    if (resultCountMap[1] !== 0) {  // é¦–å…ˆï¼ŒæŠ¥çº¸çš„æ¦‚å¿µä¸€è‚¯å®šä¸èƒ½ä¸ºé›¶[æ¡ä»¶å¯å¿½ç•¥
      const oneNumber = resultCountMap[1];
      const findLeopard = entries.find(([key, value]) => {
        if (key === "1") return false;  // å½“ç„¶ä¸å¯ä»¥ä¸º1   æ¡ä»¶å¯å¿½ç•¥ï¼š1åŠ æœ¬èº«åªèƒ½æ˜¯å¶æ•°ï¼Œä¸å¯èƒ½ç­‰äºäº”
        return value + oneNumber === 5
      });
      if (findLeopard) {
        return resultSpecial.innerHTML = `ğŸ†è±¹å­<img src="./dice-svg/${findLeopard[0]}.svg"/>(${findLeopard[1]}+${oneNumber})+1ä¸ª`
      }
    }
    // æ£€æŸ¥æ˜¯å¦æ˜¯é¡ºå­(é¡ºå­ï¼Œå°±æ˜¯5é¢—éª°å­ï¼Œæ²¡æœ‰ç›¸åŒçš„ï¼Œå°±æ˜¯é¡ºå­:::å°±æ˜¯åˆ—è¡¨çš„valueå…¨éƒ¨è¦<=1)
    if (entries.every(([_key, value]) => value <= 1)) {
      return resultSpecial.innerHTML = `é¡ºå­(é‡æ‘‡æˆ–å½’0)`
    }

    // è¾“å‡ºé0ä¸ªçš„ç»“æœ
    let resultText = '';
    for (let i = 1; i <= 6; i++) {
      if (resultCountMap[i] > 0) {
        resultText += `<div><img src="./dice-svg/${i}.svg"/><div>${resultCountMap[i]}ä¸ª</div></div>`;
      }
    }
    result.innerHTML = resultText;
  }
  
  /**
   * éª°ç›…åŠé€æ˜
   * 
   * @author ğ“’ğ“±ğ“®ğ“·ğ“–ğ“¾ğ“ªğ“·ğ“°ğ“›ğ“¸ğ“·ğ“°
   * @since 2025/9/15 22:03
   */
  function handleTransparency(checkbox) {
    if (checkbox.checked) diceCover.style.background = 'radial-gradient(#ffffffad 0%, #000000d4 100%)';
    else diceCover.style.background = 'radial-gradient(#fff 0%, #000 100%)';
  }

</script>
</html>