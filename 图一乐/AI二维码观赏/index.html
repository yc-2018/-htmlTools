<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.1, maximum-scale=5.0">
  <title>AI二维码欣赏</title>
  <link rel="stylesheet" href="./index.css">
</head>
<body>
<div class="container">
  <h1>AI二维码欣赏</h1>
  <!--trae编写，始于2026.1.8-->
  <div class="image-list" id="imageList"></div>
</div>

<div id="imageModal" class="modal">
  <span class="close">&times;</span>
  <a class="prev">&#10094;</a>
  <div class="drag-image" id="dragImage">
    <img class="modal-content" id="modalImage">
    <div class="image-container" id="imageContainer" style="display: none;"></div>
  </div>
  <a class="next">&#10095;</a>
  <div class="image-index" id="imageIndex"></div>
</div>

<script>
  const images = [
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/342940/26/5634/219805/68ce9909Fff427d49/d17003fdd182fc88.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/344189/27/5598/2147716/68ce9941Fd1bd6244/91771b243aa2519b.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/344545/36/5161/261567/68ce97b9F570dc3be/a4cfb662b8a3a9ef.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/345185/15/5533/237906/68ce97fcFb0d61fc6/26a470fe0fafb612.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/326527/9/22483/198579/68ce9820F0f42d8a2/5d37447f8c6ff3e3.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/340822/19/12639/2907288/68ce9a19F62462a7b/ba605a4aa2d20c4a.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/323433/29/22100/2435362/68ce9cdeF976fe62d/ecb128c7cb37eb1c.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/349257/16/5711/3352102/68ce9e15Ffde274b0/97efe14e9ec345a2.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/330809/13/15721/3493143/68ce9e83F3e5d0226/1279e7c49609e8b5.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/331959/12/15630/3260237/68ce9ea8F84deebb9/d4dd689601361c21.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/333329/37/15463/3589941/68cea0a2Fdadefc8e/8ca14aca2ee05072.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/333715/1/15479/2270789/68cea0d5Ff0d7e9df/eb30e318ae35f5f7.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/333069/21/15651/3375512/68cea15dF13bf4be9/d9de80987e41de98.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/346780/26/5727/3296736/68cea2beF84fb994e/84c4332c2bf5861d.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/339470/35/13043/2793766/68cea322Fbe73714a/126de6beb7bb4666.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/322269/2/14049/2852079/68cea60aFd363b5fa/edfac1e3229a67d1.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/333425/18/15522/3113947/68cea82cFf10a8ef8/d2ccd2e617171987.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/342060/2/5666/3283879/68cea8b6Fc3816828/597ab06e05116d07.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/344336/35/4657/3279357/68cea932F76342de0/feea567670c0ebf3.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/322024/4/10985/173481/68cea9b4Fd247f3ce/cc85bd5046c0963a.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/338868/22/13043/174732/68ceae69F06a97348/f641cc86326bf429.png",
    "https://img11.360buyimg.com/cxxjwimg/jfs/t1/342289/31/5640/157626/68ce9764Fc174c20d/ea9eb95b1cc889e1.png",
  ];

  const imagesBak = [
    'https://i.postimg.cc/SRdZrjYk/d17003fdd182fc88.png',
    'https://i.postimg.cc/WbpY4mxN/91771b243aa2519b.png',
    'https://i.postimg.cc/FFVnmCCv/a4cfb662b8a3a9ef.png',
    'https://i.postimg.cc/xTjpdGBY/26a470fe0fafb612.png',
    'https://i.postimg.cc/4N423vqS/5d37447f8c6ff3e3.png',
    'https://i.postimg.cc/vH82m7C4/ba605a4aa2d20c4a.png',
    'https://i.postimg.cc/pXVcdQ35/ecb128c7cb37eb1c.png',
    'https://i.postimg.cc/yYfQ3gzx/97efe14e9ec345a2.png',
    'https://i.postimg.cc/pX0G5htz/1279e7c49609e8b5.png',
    'https://i.postimg.cc/RVPsJ6zg/d4dd689601361c21.png',
    'https://i.postimg.cc/MKsPfM8P/8ca14aca2ee05072.png',
    'https://i.postimg.cc/SxJZ6SS4/eb30e318ae35f5f7.png',
    'https://i.postimg.cc/L8nyt992/d9de80987e41de98.png',
    'https://i.postimg.cc/g2Qg4Cj2/84c4332c2bf5861d.png',
    'https://i.postimg.cc/Sx3gVBRJ/126de6beb7bb4666.png',
    'https://i.postimg.cc/25W2t0Lv/edfac1e3229a67d1.png',
    'https://i.postimg.cc/k4dfPWWY/d2ccd2e617171987.png',
    'https://i.postimg.cc/R0tXYgJR/597ab06e05116d07.png',
    'https://i.postimg.cc/bvn35mSm/feea567670c0ebf3.png',
    'https://i.postimg.cc/bJj3f115/cc85bd5046c0963a.png',
    'https://i.postimg.cc/G21qnvkw/f641cc86326bf429.png',
    'https://i.postimg.cc/JnWPCjbr/ea9eb95b1cc889e1.png',
  ]

  let currentIndex = 0;
  let scale = 1;
  let isDragging = false;
  let startX, startY;
  let initialTouchDistance = 0;
  let initialTouchScale = 1;
  let isMobile = false;
  let touchStartX = 0;
  let touchEndX = 0;
  let touchStartY = 0;
  let touchEndY = 0;
  let lastTapTime = 0;
  let indexTimeout = null;
  let containerStartX = 0;
  
  // 检测是否为手机端
  function detectMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }
  
  isMobile = detectMobile();

  const imageList = document.getElementById('imageList');
  const modal = document.getElementById('imageModal');
  const dragImage = document.getElementById('dragImage');
  const modalImage = document.getElementById('modalImage');
  const imageContainer = document.getElementById('imageContainer');
  const closeBtn = document.getElementsByClassName('close')[0];
  const prevBtn = document.getElementsByClassName('prev')[0];
  const nextBtn = document.getElementsByClassName('next')[0];
  const imageIndex = document.getElementById('imageIndex');

  function renderImages() {
    images.forEach((src, index) => {
      const imageItem = document.createElement('div');
      imageItem.className = 'image-item';
      imageItem.innerHTML = `<img src="${src}" alt="图片 ${index + 1}" onclick="openModal(${index})" loading="lazy">`;
      imageList.appendChild(imageItem);
    });
  }

  function openModal(index) {
    currentIndex = index;
    modal.style.display = 'flex';
    
    if (isMobile) {
      // 手机端：使用滑动方式
      modalImage.style.display = 'none';
      imageContainer.style.display = 'flex';
      loadImagesToContainer();
      updateImagePosition();
    } else {
      // 电脑端：使用原始方式
      modalImage.style.display = 'block';
      imageContainer.style.display = 'none';
      modalImage.src = images[currentIndex];
      resetImage();
    }
    
    // 显示图片索引
    showImageIndex();
  }

  function closeModal() {
    modal.style.display = 'none';
    resetImage();
  }

  function resetImage() {
    scale = 1;
    dragImage.style.transform = 'scale(1) translateX(0px) translateY(0px)';
    updateImagePosition();
  }

  function changeImage(n) {
    currentIndex += n;
    if (currentIndex < 0) {
      currentIndex = images.length - 1;
    } else if (currentIndex >= images.length) {
      currentIndex = 0;
    }
    
    if (isMobile) {
      // 手机端：使用滑动方式，更新位置
      updateImagePosition();
    } else {
      // 电脑端：直接更新图片
      modalImage.src = images[currentIndex];
      resetImage();
    }
    
    showImageIndex();
  }
  
  function loadImagesToContainer() {
    // 清空容器
    imageContainer.innerHTML = '';
    
    // 加载所有图片
    images.forEach((src, index) => {
      const img = document.createElement('img');
      img.src = src;
      img.className = 'modal-content';
      img.dataset.index = index;
      imageContainer.appendChild(img);
    });
  }
  
  function updateImagePosition() {
    // 更新图片容器位置
    const translateX = -currentIndex * 100 + '%';
    imageContainer.style.transform = `translateX(${translateX})`;
  }

  function handleWheel(event) {
    event.preventDefault();
    const delta = event.deltaY > 0 ? -0.1 : 0.1;
    scale = Math.max(0.1, Math.min(5, scale + delta));
    const currentTransform = dragImage.style.transform;
    const translateX = parseInt(currentTransform.match(/translateX\(([^)]+)\)/)?.[1] || 0) || 0;
    const translateY = parseInt(currentTransform.match(/translateY\(([^)]+)\)/)?.[1] || 0) || 0;
    dragImage.style.transform = `scale(${scale}) translateX(${translateX}px) translateY(${translateY}px)`;
  }

  function calculateDistance(touch1, touch2) {
    const dx = touch2.clientX - touch1.clientX;
    const dy = touch2.clientY - touch1.clientY;
    return Math.sqrt(dx * dx + dy * dy);
  }

  function startDrag(e) {
    isDragging = true;
    if (e.touches && e.touches.length === 2) {
      initialTouchDistance = calculateDistance(e.touches[0], e.touches[1]);
      initialTouchScale = scale;
    } else {
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      startX = clientX - (parseInt(dragImage.style.transform.match(/translateX\(([^)]+)\)/)?.[1] || 0) || 0);
      startY = clientY - (parseInt(dragImage.style.transform.match(/translateY\(([^)]+)\)/)?.[1] || 0) || 0);
    }
    e.preventDefault();
  }

  function drag(e) {
    if (!isDragging) return;
    e.preventDefault();
    
    if (e.touches && e.touches.length === 2) {
      const currentDistance = calculateDistance(e.touches[0], e.touches[1]);
      const scaleFactor = currentDistance / initialTouchDistance;
      scale = Math.max(0.1, Math.min(5, initialTouchScale * scaleFactor));
      const currentTransform = dragImage.style.transform;
      const translateX = parseInt(currentTransform.match(/translateX\(([^)]+)\)/)?.[1] || 0) || 0;
      const translateY = parseInt(currentTransform.match(/translateY\(([^)]+)\)/)?.[1] || 0) || 0;
      dragImage.style.transform = `scale(${scale}) translateX(${translateX}px) translateY(${translateY}px)`;
    } else {
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const offsetX = clientX - startX;
      const offsetY = clientY - startY;
      dragImage.style.transform = `scale(${scale}) translateX(${offsetX}px) translateY(${offsetY}px)`;
    }
  }

  function stopDrag() {
    isDragging = false;
  }
  
  function showImageIndex() {
    imageIndex.textContent = `${currentIndex + 1}/${images.length}`;
    imageIndex.classList.add('visible');
    
    // 清除之前的定时器
    if (indexTimeout) {
      clearTimeout(indexTimeout);
    }
    
    // 1秒后隐藏图片索引
    indexTimeout = setTimeout(() => {
      imageIndex.classList.remove('visible');
    }, 1000);
  }
  
  function handleMobileTouchStart(e) {
    if (!isMobile) return;
    
    if (e.touches.length === 1) {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
      // 移除过渡效果，实现跟随滑动
      imageContainer.style.transition = 'none';
    } else if (e.touches.length === 2) {
      // 双指触摸，计算初始距离
      initialTouchDistance = calculateDistance(e.touches[0], e.touches[1]);
      initialTouchScale = scale;
    }
  }
  
  function handleMobileTouchMove(e) {
    if (!isMobile) return;
    
    if (e.touches.length === 1) {
      touchEndX = e.touches[0].clientX;
      touchEndY = e.touches[0].clientY;
      
      // 计算滑动距离
      const deltaX = touchEndX - touchStartX;
      
      // 实现图片跟随滑动效果
      const currentPosition = -currentIndex * 100;
      const newPosition = currentPosition + (deltaX / window.innerWidth) * 100;
      imageContainer.style.transform = `translateX(${newPosition}%)`;
    } else if (e.touches.length === 2) {
      // 双指缩放
      e.preventDefault();
      const currentDistance = calculateDistance(e.touches[0], e.touches[1]);
      const scaleFactor = currentDistance / initialTouchDistance;
      scale = Math.max(0.1, Math.min(5, initialTouchScale * scaleFactor));
      dragImage.style.transform = `scale(${scale}) translateX(0px) translateY(0px)`;
    }
  }
  
  function handleMobileTouchEnd(e) {
    if (!isMobile) return;
    
    if (e.touches.length === 0) {
      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      
      // 添加过渡效果，实现平滑切换
      imageContainer.style.transition = 'transform 0.3s ease';
      
      // 判断是滑动还是点击
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 80) {
        // 左右滑动，翻页
        e.preventDefault();
        if (deltaX > 0) {
          // 向右滑动，上一张
          changeImage(-1);
        } else {
          // 向左滑动，下一张
          changeImage(1);
        }
        // 显示图片索引
        showImageIndex();
      } else if (Math.abs(deltaX) < 30 && Math.abs(deltaY) < 30) {
        // 点击，使用时间间隔判断是单击还是双击
        const now = Date.now();
        const tapInterval = now - lastTapTime;
        
        if (tapInterval < 300) {
          // 双击，放大/缩小
          if (scale > 1) {
            // 已放大，恢复原始大小
            scale = 1;
          } else {
            // 原始大小，放大
            scale = 2;
          }
          dragImage.style.transform = `scale(${scale}) translateX(0px) translateY(0px)`;
        } 
        // 无论单击还是双击，都不执行退出操作，由专门的点击事件处理
        lastTapTime = now;
      } else {
        // 滑动距离不足，恢复原位
        updateImagePosition();
      }
    }
  }

  renderImages();

  closeBtn.onclick = closeModal;
  prevBtn.onclick = () => changeImage(-1);
  nextBtn.onclick = () => changeImage(1);

  modal.onclick = (e) => {
    if (e.target === modal) {
      closeModal();
    }
  };

  window.onkeydown = (e) => {
    if (modal.style.display === 'flex') {
      if (e.key === 'Escape') closeModal();
      if (e.key === 'ArrowLeft') changeImage(-1);
      if (e.key === 'ArrowRight') changeImage(1);
    }
  };

  // 为电脑端恢复原始的滚轮缩放功能
  modalImage.addEventListener('wheel', handleWheel);
  
  // 根据设备类型绑定不同的事件
  if (isMobile) {
    // 手机端事件处理
    dragImage.addEventListener('touchstart', handleMobileTouchStart, { passive: true });
    document.addEventListener('touchmove', handleMobileTouchMove, { passive: false });
    document.addEventListener('touchend', handleMobileTouchEnd, { passive: true });
    
    // 添加明确的单击退出机制
    imageContainer.addEventListener('click', (e) => {
      if (e.target.tagName === 'IMG') {
        closeModal();
      }
    });
  } else {
    // 电脑端事件处理 - 恢复原始功能
    dragImage.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);
    
    // 电脑端不需要点击退出功能，移除所有相关事件监听
    // 确保电脑端可以正常拖拽和缩放
  }
</script>
</body>
</html>