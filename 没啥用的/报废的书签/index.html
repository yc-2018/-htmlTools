<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¹¦ç­¾ç®¡ç†å™¨</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
          background-color: #f5f5f5;
          color: #333;
          line-height: 1.6;
          display: flex;
          height: 100vh;
          overflow: hidden;
      }

      .sidebar {
          width: 250px;
          background-color: #f1f3f4;
          border-right: 1px solid #dadce0;
          overflow-y: auto;
          padding: 16px;
      }

      .sidebar-header {
          padding: 10px 0;
          font-weight: 500;
          color: #5f6368;
          font-size: 14px;
          border-bottom: 1px solid #dadce0;
          margin-bottom: 10px;
      }

      .folder-item {
          padding: 8px 0;
          cursor: pointer;
          user-select: none;
      }

      .folder-name {
          display: flex;
          align-items: center;
          padding: 4px 8px;
          border-radius: 4px;
      }

      .folder-name:hover {
          background-color: #e8eaed;
      }

      .folder-name.active {
          background-color: #e8f0fe;
          color: #1a73e8;
      }

      .folder-icon {
          margin-right: 8px;
          font-size: 16px;
          width: 16px;
          text-align: center;
      }

      .folder-children {
          margin-left: 20px;
          display: none;
      }

      .folder-children.expanded {
          display: block;
      }

      .main-content {
          flex: 1;
          padding: 20px;
          overflow-y: auto;
      }

      .search-box {
          margin-bottom: 20px;
      }

      .search-box input {
          width: 100%;
          padding: 10px 15px;
          border: 1px solid #dfe1e5;
          border-radius: 24px;
          font-size: 14px;
          outline: none;
      }

      .search-box input:focus {
          box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
          border-color: rgba(223, 225, 229, 0);
      }

      .bookmarks-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 16px;
      }

      .bookmark-item {
          background-color: white;
          border-radius: 8px;
          padding: 16px;
          box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
          cursor: pointer;
          transition: transform 0.2s;
          display: flex;
          align-items: flex-start;
      }

      .bookmark-item:hover {
          transform: translateY(-2px);
          box-shadow: 0 2px 4px rgba(60, 64, 67, 0.3), 0 2px 6px 2px rgba(60, 64, 67, 0.15);
      }

      .bookmark-icon {
          width: 16px;
          height: 16px;
          margin-right: 10px;
          flex-shrink: 0;
      }

      .bookmark-info {
          flex: 1;
          min-width: 0;
      }

      .bookmark-title {
          font-size: 14px;
          font-weight: 500;
          margin-bottom: 4px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      .bookmark-url {
          font-size: 12px;
          color: #5f6368;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      .folder-content-item {
          display: flex;
          align-items: center;
          padding: 12px;
          background-color: white;
          border-radius: 8px;
          margin-bottom: 8px;
          box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
          cursor: pointer;
      }

      .folder-content-item:hover {
          background-color: #f8f9fa;
      }

      .empty-state {
          text-align: center;
          padding: 40px 0;
          color: #5f6368;
      }
  </style>
</head>
<body>
<div class="sidebar">
  <div class="sidebar-header">ä¹¦ç­¾</div>
  <div id="foldersList"></div>
</div>

<div class="main-content">
  <div class="search-box">
    <input type="text" placeholder="æœç´¢ä¹¦ç­¾..." id="searchInput">
  </div>

  <div id="contentArea">
    <div class="empty-state" id="emptyState">
      <p>æ²¡æœ‰ä¹¦ç­¾æ•°æ®</p>
      <p>è¯·ç¡®ä¿a.jsonæ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®</p>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const foldersList = document.getElementById('foldersList');
    const contentArea = document.getElementById('contentArea');
    const emptyState = document.getElementById('emptyState');
    const searchInput = document.getElementById('searchInput');

    let allBookmarks = [];
    let currentFolder = null;
    let folderElementsMap = new Map(); // å­˜å‚¨æ–‡ä»¶å¤¹IDåˆ°DOMå…ƒç´ çš„æ˜ å°„

    // åŠ è½½ä¹¦ç­¾æ•°æ®
    fetch('./a.json')
      .then(response => response.json())
      .then(data => {
        allBookmarks = data;
        renderFolders(data);
        // é»˜è®¤æ˜¾ç¤ºä¹¦ç­¾æ çš„å†…å®¹
        const bookmarkBar = findBookmarkBar(data);
        if (bookmarkBar) {
          selectFolder(bookmarkBar);
          // é»˜è®¤å±•å¼€ä¹¦ç­¾æ 
          const bookmarkBarElement = folderElementsMap.get(bookmarkBar.id || 'bookmark_bar');
          if (bookmarkBarElement) {
            const folderName = bookmarkBarElement.querySelector('.folder-name');
            if (folderName) {
              folderName.click(); // æ¨¡æ‹Ÿç‚¹å‡»ä»¥å±•å¼€
            }
          }
        }
      })
      .catch(error => {
        console.error('åŠ è½½ä¹¦ç­¾æ•°æ®å¤±è´¥:', error);
        emptyState.innerHTML = `<p>åŠ è½½ä¹¦ç­¾æ•°æ®å¤±è´¥</p><p>${error.message}</p>`;
      });

    // ä»URLæå–åŸŸå
    function getDomain(url) {
      if (!url) return '';
      try {
        const urlObj = new URL(url);
        return urlObj.hostname;
      } catch (e) {
        return '';
      }
    }

    // è·å–favicon URL
    function getFaviconUrl(url) {
      const domain = getDomain(url);
      if (!domain) return '';

      // å…ˆå°è¯•ç›´æ¥ä½¿ç”¨ç½‘ç«™çš„favicon.ico
      return `https://${domain}/favicon.ico`;
    }

    // æŸ¥æ‰¾ä¹¦ç­¾æ 
    function findBookmarkBar(data) {
      if (Array.isArray(data)) {
        // å¦‚æœæ•°æ®æ˜¯æ•°ç»„ï¼ŒæŸ¥æ‰¾typeä¸º'folder'ä¸”titleä¸º'ä¹¦ç­¾æ 'çš„é¡¹
        return data.find(item => item.type === 'folder' && item.title === 'ä¹¦ç­¾æ ');
      } else if (data.roots) {
        // å¦‚æœæ•°æ®æ˜¯Chromeå¯¼å‡ºæ ¼å¼
        return data.roots.bookmark_bar || null;
      }
      return null;
    }

    // æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦æœ‰å­æ–‡ä»¶å¤¹
    function hasSubfolders(folder) {
      if (!folder.children || folder.children.length === 0) return false;
      return folder.children.some(child => child.type === 'folder');
    }

    // æ¸²æŸ“æ–‡ä»¶å¤¹æ ‘
    function renderFolders(data) {
      foldersList.innerHTML = '';
      folderElementsMap.clear();

      // å¤„ç†ä¹¦ç­¾æ 
      const bookmarkBar = findBookmarkBar(data);
      if (bookmarkBar) {
        // ç¡®ä¿ä¹¦ç­¾æ æœ‰ID
        if (!bookmarkBar.id) {
          bookmarkBar.id = 'bookmark_bar';
        }
        const bookmarkBarElement = createFolderElement(bookmarkBar);
        foldersList.appendChild(bookmarkBarElement);
        folderElementsMap.set(bookmarkBar.id, bookmarkBarElement);
      }

      // å¤„ç†å…¶ä»–ä¹¦ç­¾
      let otherBookmarks = [];
      if (Array.isArray(data)) {
        otherBookmarks = data.filter(item => item.type === 'link');
      } else if (data.roots && data.roots.other) {
        otherBookmarks = data.roots.other.children || [];
      }

      if (otherBookmarks.length > 0) {
        const otherBookmarksElement = document.createElement('div');
        otherBookmarksElement.className = 'folder-item';
        otherBookmarksElement.innerHTML = `
          <div class="folder-name" data-folder-id="other">
            <span class="folder-icon">ğŸ“</span>
            <span>å…¶ä»–ä¹¦ç­¾</span>
          </div>
        `;
        otherBookmarksElement.querySelector('.folder-name').addEventListener('click', function() {
          selectFolder({
            id: 'other',
            title: 'å…¶ä»–ä¹¦ç­¾',
            children: otherBookmarks
          });
        });
        foldersList.appendChild(otherBookmarksElement);
        folderElementsMap.set('other', otherBookmarksElement);
      }
    }

    // åˆ›å»ºæ–‡ä»¶å¤¹å…ƒç´ 
    function createFolderElement(folder) {
      const folderElement = document.createElement('div');
      folderElement.className = 'folder-item';

      // ç¡®ä¿æ–‡ä»¶å¤¹æœ‰ID
      if (!folder.id) {
        folder.id = folder.title || Math.random().toString(36).substring(2);
      }

      // æ£€æŸ¥æ˜¯å¦æœ‰å­æ–‡ä»¶å¤¹
      const hasChildren = hasSubfolders(folder);

      folderElement.innerHTML = `
        <div class="folder-name" data-folder-id="${folder.id}">
          <span class="folder-icon">${hasChildren ? 'â–¶' : 'ğŸ“'}</span>
          <span>${folder.title || 'æœªå‘½åæ–‡ä»¶å¤¹'}</span>
        </div>
        ${hasChildren ? `<div class="folder-children"></div>` : ''}
      `;

      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      folderElement.querySelector('.folder-name').addEventListener('click', function() {
        selectFolder(folder);

        // åˆ‡æ¢å±•å¼€/æŠ˜å çŠ¶æ€
        if (hasChildren) {
          const childrenContainer = folderElement.querySelector('.folder-children');
          const icon = folderElement.querySelector('.folder-icon');

          if (childrenContainer.classList.contains('expanded')) {
            childrenContainer.classList.remove('expanded');
            icon.textContent = 'â–¶';
          } else {
            childrenContainer.classList.add('expanded');
            icon.textContent = 'â–¼';
          }
        }
      });

      // é€’å½’æ¸²æŸ“å­æ–‡ä»¶å¤¹
      if (hasChildren) {
        const childrenContainer = folderElement.querySelector('.folder-children');
        folder.children.forEach(child => {
          if (child.type === 'folder') {
            const childElement = createFolderElement(child);
            childrenContainer.appendChild(childElement);
            folderElementsMap.set(child.id, childElement);
          }
        });
      }

      return folderElement;
    }

    // é€‰æ‹©æ–‡ä»¶å¤¹å¹¶æ˜¾ç¤ºå†…å®¹
    function selectFolder(folder) {
      currentFolder = folder;

      // æ›´æ–°æ´»åŠ¨çŠ¶æ€ - ç§»é™¤æ‰€æœ‰é«˜äº®
      document.querySelectorAll('.folder-name').forEach(item => {
        item.classList.remove('active');
      });

      // é«˜äº®å½“å‰æ–‡ä»¶å¤¹
      const folderId = folder.id || (folder.title === 'å…¶ä»–ä¹¦ç­¾' ? 'other' : null);
      if (folderId) {
        const folderElement = folderElementsMap.get(folderId);
        if (folderElement) {
          const folderNameElement = folderElement.querySelector('.folder-name');
          if (folderNameElement) {
            folderNameElement.classList.add('active');
          }
        }
      }

      // æ¸²æŸ“æ–‡ä»¶å¤¹å†…å®¹
      renderFolderContent(folder);
    }

    // æ¸²æŸ“æ–‡ä»¶å¤¹å†…å®¹
    function renderFolderContent(folder) {
      contentArea.innerHTML = '';

      if (!folder.children || folder.children.length === 0) {
        contentArea.innerHTML = '<div class="empty-state">æ–‡ä»¶å¤¹ä¸ºç©º</div>';
        return;
      }

      // åˆ›å»ºå†…å®¹å®¹å™¨
      const contentContainer = document.createElement('div');

      // åˆ†åˆ«å¤„ç†æ–‡ä»¶å¤¹å’Œä¹¦ç­¾
      const folders = folder.children.filter(item => item.type === 'folder');
      const bookmarks = folder.children.filter(item => item.type === 'url' || item.type === 'link');

      // æ¸²æŸ“å­æ–‡ä»¶å¤¹
      if (folders.length > 0) {
        folders.forEach(subFolder => {
          const folderElement = document.createElement('div');
          folderElement.className = 'folder-content-item';
          folderElement.innerHTML = `
            <span class="folder-icon">ğŸ“</span>
            <div>
              <div class="bookmark-title">${subFolder.title || 'æœªå‘½åæ–‡ä»¶å¤¹'}</div>
            </div>
          `;
          folderElement.addEventListener('click', (e) => {
            e.stopPropagation();
            selectFolder(subFolder);
            // åœ¨å·¦ä¾§èšç„¦åˆ°è¯¥æ–‡ä»¶å¤¹
            focusFolderInSidebar(subFolder.id);
          });
          contentContainer.appendChild(folderElement);
        });
      }

      // æ¸²æŸ“ä¹¦ç­¾
      if (bookmarks.length > 0) {
        const bookmarksContainer = document.createElement('div');
        bookmarksContainer.className = 'bookmarks-grid';

        bookmarks.forEach(bookmark => {
          const bookmarkElement = document.createElement('div');
          bookmarkElement.className = 'bookmark-item';

          // è·å–favicon URL
          const faviconUrl = getFaviconUrl(bookmark.url);
          const domain = getDomain(bookmark.url);
          const fallbackUrl = domain ? `https://toolb.cn/favicon/${domain}` : '';

          bookmarkElement.innerHTML = `
            <img class="bookmark-icon" src="${faviconUrl}" onerror="this.onerror=null; this.src='${fallbackUrl}';" />
            <div class="bookmark-info">
              <div class="bookmark-title">${bookmark.title || 'æœªå‘½åä¹¦ç­¾'}</div>
              <div class="bookmark-url">${bookmark.url || ''}</div>
            </div>
          `;

          if (bookmark.url) {
            bookmarkElement.addEventListener('click', () => {
              window.open(bookmark.url, '_blank');
            });
          }
          bookmarksContainer.appendChild(bookmarkElement);
        });

        contentContainer.appendChild(bookmarksContainer);
      }

      contentArea.appendChild(contentContainer);

      // éšè—ç©ºçŠ¶æ€
      emptyState.style.display = 'none';
    }

    // åœ¨å·¦ä¾§èšç„¦åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
    function focusFolderInSidebar(folderId) {
      const folderElement = folderElementsMap.get(folderId);
      if (folderElement) {
        // å±•å¼€æ‰€æœ‰çˆ¶æ–‡ä»¶å¤¹
        expandParentFolders(folderElement);

        // é«˜äº®æ˜¾ç¤ºè¯¥æ–‡ä»¶å¤¹
        const folderName = folderElement.querySelector('.folder-name');
        if (folderName) {
          // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
          document.querySelectorAll('.folder-name').forEach(item => {
            item.classList.remove('active');
          });

          // æ·»åŠ æ´»åŠ¨çŠ¶æ€
          folderName.classList.add('active');

          // å¦‚æœè¿™ä¸ªæ–‡ä»¶å¤¹æœ‰å­æ–‡ä»¶å¤¹ï¼Œç¡®ä¿å®ƒæ˜¯å±•å¼€çš„
          const childrenContainer = folderElement.querySelector('.folder-children');
          const icon = folderElement.querySelector('.folder-icon');
          if (childrenContainer && !childrenContainer.classList.contains('expanded')) {
            childrenContainer.classList.add('expanded');
            icon.textContent = 'â–¼';
          }

          // æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ
          folderName.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    }

    // å±•å¼€çˆ¶æ–‡ä»¶å¤¹
    function expandParentFolders(folderElement) {
      let currentElement = folderElement.parentElement;

      while (currentElement && !currentElement.classList.contains('sidebar')) {
        if (currentElement.classList.contains('folder-children')) {
          // å±•å¼€è¿™ä¸ªæ–‡ä»¶å¤¹
          currentElement.classList.add('expanded');

          // æ›´æ–°å›¾æ ‡
          const parentFolder = currentElement.parentElement;
          if (parentFolder) {
            const icon = parentFolder.querySelector('.folder-icon');
            if (icon && icon.textContent === 'â–¶') {
              icon.textContent = 'â–¼';
            }
          }
        }
        currentElement = currentElement.parentElement;
      }
    }

    // æœç´¢åŠŸèƒ½
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();

      if (searchTerm) {
        // æœç´¢æ‰€æœ‰ä¹¦ç­¾
        const filteredBookmarks = searchBookmarks(allBookmarks, searchTerm);
        renderSearchResults(filteredBookmarks);
      } else if (currentFolder) {
        // æ¢å¤æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å†…å®¹
        renderFolderContent(currentFolder);
      }
    });

    // é€’å½’æœç´¢ä¹¦ç­¾
    function searchBookmarks(data, searchTerm) {
      let results = [];

      if (Array.isArray(data)) {
        data.forEach(item => {
          if (item.type === 'url' || item.type === 'link') {
            if ((item.title && item.title.toLowerCase().includes(searchTerm)) ||
              (item.url && item.url.toLowerCase().includes(searchTerm))) {
              results.push(item);
            }
          } else if (item.type === 'folder' && item.children) {
            results = results.concat(searchBookmarks(item.children, searchTerm));
          }
        });
      } else if (data.children) {
        results = results.concat(searchBookmarks(data.children, searchTerm));
      }

      return results;
    }

    // æ¸²æŸ“æœç´¢ç»“æœ
    function renderSearchResults(results) {
      contentArea.innerHTML = '';

      if (results.length === 0) {
        contentArea.innerHTML = '<div class="empty-state">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¹¦ç­¾</div>';
        return;
      }

      const resultsContainer = document.createElement('div');
      resultsContainer.className = 'bookmarks-grid';

      results.forEach(bookmark => {
        const bookmarkElement = document.createElement('div');
        bookmarkElement.className = 'bookmark-item';

        // è·å–favicon URL
        const faviconUrl = getFaviconUrl(bookmark.url);
        const domain = getDomain(bookmark.url);
        const fallbackUrl = domain ? `https://toolb.cn/favicon/${domain}` : '';

        bookmarkElement.innerHTML = `
          <img class="bookmark-icon" src="${faviconUrl}" onerror="this.onerror=null; this.src='${fallbackUrl}';" />
          <div class="bookmark-info">
            <div class="bookmark-title">${bookmark.title || 'æœªå‘½åä¹¦ç­¾'}</div>
            <div class="bookmark-url">${bookmark.url || ''}</div>
          </div>
        `;

        if (bookmark.url) {
          bookmarkElement.addEventListener('click', () => {
            window.open(bookmark.url, '_blank');
          });
        }
        resultsContainer.appendChild(bookmarkElement);
      });

      contentArea.appendChild(resultsContainer);
    }
  });
</script>
</body>
</html>
